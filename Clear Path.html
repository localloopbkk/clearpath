<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Clear path ‚Äî Senior Reminder</title>
  <style>
    :root{
      --bg-0:#0b0c10;
      --bg-1:#111218;
      --card:#f2eee7;
      --card-2:#f7f3ee;
      --ink:#0b0c10;
      --muted:#6b6f7a;
      --line:rgba(11,12,16,.12);
      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --radius: 22px;
      --radius2: 28px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";

      /* Type colors (requested) */
      --c-payment: #ff4d4d;     /* Payment > Red */
      --c-medicine:#3d7bff;     /* Medicine > Blue */
      --c-electric:#ff7a3d;     /* Electricity > Orange */
      --c-appointment:#27c06a;  /* Appointment > Green */
      --c-other:   #ffd24d;     /* Other > Yellow */

      /* Accent for buttons */
      --accent1:#ff4d4d;
      --accent2:#ff7a3d;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font);
      background:
        radial-gradient(1100px 700px at 20% 5%, rgba(255,122,61,.24), transparent 55%),
        radial-gradient(900px 600px at 90% 15%, rgba(255,77,77,.20), transparent 60%),
        radial-gradient(900px 650px at 50% 110%, rgba(255,210,77,.10), transparent 55%),
        linear-gradient(180deg, var(--bg-0), var(--bg-1));
      color:#fff;
      display:grid;
      place-items:center;
      padding:28px 12px;
      overflow-x:hidden;
    }

    .wrap{
      width:min(100%, 1240px);
      display:grid;
      grid-template-columns: 1fr;
      gap:22px;
      align-items:start;
    }

    /* Phone shell */
    .phone{
      width:min(420px, 100%);
      margin:0 auto;
      border-radius: 38px;
      background: rgba(255,255,255,.06);
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.12);
      padding:14px;
      position:relative;
    }
    .phone::before{
      content:"";
      position:absolute;
      inset:10px 95px auto 95px;
      height:26px;
      border-radius:16px;
      background: rgba(0,0,0,.45);
      top:10px;
      pointer-events:none;
      opacity:.75;
    }

    .screen{
      background: var(--card);
      color: var(--ink);
      border-radius: 30px;
      min-height: 760px;
      overflow:hidden;
      position:relative;
    }

    .topbar{
      padding: 18px 18px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:650;
      letter-spacing:.2px;
    }
    .logo{
      width:34px;height:34px;border-radius:12px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.85), rgba(255,255,255,.35)),
                  linear-gradient(135deg, var(--accent1), var(--accent2));
      box-shadow: 0 8px 18px rgba(255,77,77,.22);
      display:grid;place-items:center;
      color:#fff;
      font-size:16px;
      font-weight:800;
    }
    .iconbtn{
      border:1px solid rgba(11,12,16,.08);
      background: rgba(255,255,255,.65);
      border-radius: 14px;
      width:44px;height:44px;
      display:grid;place-items:center;
      cursor:pointer;
      transition:.15s transform, .15s filter;
      user-select:none;
    }
    .iconbtn:active{transform:scale(.98); filter:brightness(.98)}
    .iconbtn svg{width:20px;height:20px;opacity:.9}

    .content{
      padding: 0 18px 96px;
    }

    .title{
      font-size:42px;
      line-height:1.02;
      letter-spacing:-.8px;
      margin: 8px 0 8px;
      font-weight:820;
    }
    .subtitle{
      margin:0 0 14px;
      color: var(--muted);
      font-size:14px;
      line-height:1.4;
    }

    .seg{
      display:flex;
      gap:10px;
      background: rgba(11,12,16,.06);
      border:1px solid rgba(11,12,16,.06);
      padding:6px;
      border-radius: 18px;
      width: fit-content;
      margin: 10px 0 14px;
    }
    .seg button{
      border:0;
      background:transparent;
      padding:10px 12px;
      border-radius: 14px;
      cursor:pointer;
      color: rgba(11,12,16,.7);
      font-weight:650;
      font-size:13px;
      transition:.15s;
    }
    .seg button.active{
      background: rgba(255,255,255,.75);
      color: rgba(11,12,16,.92);
      box-shadow: 0 8px 20px rgba(0,0,0,.08);
    }

    .row{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
    }

    .card{
      background: rgba(255,255,255,.75);
      border:1px solid rgba(11,12,16,.07);
      border-radius: var(--radius2);
      padding: 14px;
      box-shadow: 0 14px 28px rgba(0,0,0,.10);
    }
    .card + .card{margin-top:12px}

    .statgrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin: 12px 0 14px;
    }
    .stat{
      background: rgba(255,255,255,.72);
      border:1px solid rgba(11,12,16,.07);
      border-radius: 22px;
      padding: 12px 12px;
      display:flex;
      flex-direction:column;
      gap:6px;
      min-height:86px;
    }
    .stat .k{font-size:12px;color:var(--muted);font-weight:650}
    .stat .v{font-size:22px;font-weight:850;letter-spacing:-.4px}
    .stat .s{font-size:12px;color:rgba(11,12,16,.64)}
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      background: rgba(11,12,16,.06);
      border:1px solid rgba(11,12,16,.06);
      border-radius: 999px;
      font-size:12px;
      color: rgba(11,12,16,.72);
      font-weight:650;
      width:fit-content;
    }

    /* Reminder rows */
    .reminder{
      display:flex;
      gap:12px;
      align-items:flex-start;
      justify-content:space-between;
      padding: 12px;
      border-radius: 20px;
      border:1px solid rgba(11,12,16,.08);
      background: rgba(255,255,255,.70);
      cursor:pointer;
      transition:.12s transform, .12s filter;
    }
    .reminder:hover{filter:brightness(1.01)}
    .reminder:active{transform:scale(.995)}
    .reminder + .reminder{margin-top:10px}
    .rem-left{display:flex;gap:12px;align-items:flex-start}
    .dot{
      width:12px;height:12px;border-radius:999px;margin-top:6px;
      background: linear-gradient(135deg, var(--accent1), var(--accent2));
      box-shadow: 0 10px 18px rgba(0,0,0,.10);
      flex:none;
    }
    .rem-title{font-weight:820; letter-spacing:-.2px}
    .rem-meta{color:var(--muted); font-size:12px; margin-top:2px}

    .pill{
      border-radius: 999px;
      padding:8px 10px;
      background: rgba(11,12,16,.06);
      border:1px solid rgba(11,12,16,.06);
      color: rgba(11,12,16,.75);
      font-size:12px;
      font-weight:700;
      display:inline-flex;
      align-items:center;
      gap:8px;
      user-select:none;
      transition:.15s transform;
      white-space:nowrap;
      cursor:pointer;
    }
    .pill:active{transform:scale(.98)}
    .pill svg{width:14px;height:14px;opacity:.85}

    .cta{
      margin-top:12px;
      border-radius: 22px;
      padding: 14px;
      border: 1px solid rgba(11,12,16,.08);
      background: linear-gradient(135deg, rgba(255,77,77,.15), rgba(255,122,61,.15)),
                  rgba(255,255,255,.68);
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
    }
    .cta strong{font-weight:860}

    .btn{
      border:0;
      cursor:pointer;
      border-radius: 16px;
      padding: 12px 14px;
      font-weight:850;
      letter-spacing:-.2px;
      box-shadow: 0 14px 30px rgba(255,77,77,.18);
      background: linear-gradient(135deg, var(--accent1), var(--accent2));
      color:#fff;
      display:inline-flex;
      gap:10px;
      align-items:center;
      user-select:none;
      transition:.15s transform, .15s filter;
    }
    .btn:active{transform:scale(.99); filter:brightness(.98)}
    .btn svg{width:16px;height:16px}

    /* Bottom nav */
    .nav{
      position:absolute;
      left:14px;
      right:14px;
      bottom:14px;
      background: rgba(255,255,255,.82);
      border: 1px solid rgba(11,12,16,.08);
      border-radius: 22px;
      padding: 10px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      box-shadow: 0 18px 40px rgba(0,0,0,.12);
      backdrop-filter: blur(10px);
      z-index: 5;
    }
    .nav button{
      border:0;
      background: transparent;
      width: 25%;
      padding:10px 8px;
      border-radius: 18px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:6px;
      cursor:pointer;
      color: rgba(11,12,16,.55);
      font-size:11px;
      font-weight:700;
      user-select:none;
      transition:.15s;
    }
    .nav button svg{width:20px;height:20px;opacity:.9}
    .nav button.active{
      background: rgba(11,12,16,.06);
      color: rgba(11,12,16,.85);
    }
    .nav button.active .navdot{
      width:16px;height:4px;border-radius:999px;
      background: linear-gradient(135deg, var(--accent1), var(--accent2));
      margin-top:2px;
    }

    /* Views */
    .view{display:none}
    .view.active{display:block}

    /* Modal / Sheet */
    .modal{
      position:absolute;
      inset:0;
      background: rgba(0,0,0,.45);
      display:none;
      align-items:flex-end;
      justify-content:center;
      padding:14px;
      z-index: 40;
    }
    .modal.show{display:flex}
    .sheet{
      width:100%;
      background: rgba(247,243,238,.98);
      border: 1px solid rgba(255,255,255,.35);
      border-radius: 26px;
      padding: 14px;
      box-shadow: 0 30px 70px rgba(0,0,0,.35);
      color: var(--ink);
      max-height: 85%;
      overflow:auto;
    }
    .sheet .head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .sheet h3{
      margin:0;
      font-size:18px;
      letter-spacing:-.2px;
    }
    .field{
      display:flex;
      flex-direction:column;
      gap:6px;
      margin:10px 0;
    }
    .field label{
      font-size:12px;
      color: rgba(11,12,16,.62);
      font-weight:750;
    }
    .input, select, textarea{
      width:100%;
      padding: 12px 12px;
      border-radius: 16px;
      border:1px solid rgba(11,12,16,.12);
      background: rgba(255,255,255,.8);
      font-size:14px;
      outline:none;
      font-family: var(--font);
    }
    textarea{min-height:84px; resize:vertical}
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .actions{
      display:flex;
      gap:10px;
      margin-top:12px;
    }
    .ghost{
      border: 1px solid rgba(11,12,16,.12);
      background: rgba(255,255,255,.75);
      color: rgba(11,12,16,.78);
      box-shadow:none;
    }

    .empty{
      text-align:center;
      padding: 28px 10px;
      color: rgba(11,12,16,.65);
    }

    /* Calendar */
    .calgrid{
      display:grid;
      grid-template-columns: repeat(7, 1fr);
      gap:8px;
      margin-top:12px;
    }
    .calhead{
      display:grid;
      grid-template-columns: repeat(7, 1fr);
      gap:8px;
      margin-top:12px;
    }
    .calhead div{
      font-size:12px;
      color: rgba(11,12,16,.55);
      font-weight:800;
      text-align:center;
    }
    .calbtn{
      height:42px;
      border-radius:14px;
      border:1px solid rgba(11,12,16,.10);
      background: rgba(255,255,255,.78);
      cursor:pointer;
      font-weight:850;
      color: rgba(11,12,16,.85);
      position:relative;
      padding:0;
    }
    .calbtn.is-today{
      outline:2px solid rgba(255,77,77,.35);
      box-shadow: 0 12px 24px rgba(255,77,77,.12);
    }
    .calbtn.is-selected{
      background: linear-gradient(135deg, rgba(255,77,77,.18), rgba(255,122,61,.16)), rgba(255,255,255,.85);
    }
    .calmarks{
      position:absolute;
      left:7px;
      right:7px;
      bottom:6px;
      display:flex;
      gap:4px;
      justify-content:center;
      pointer-events:none;
    }
    .mark{
      width:7px;height:7px;border-radius:999px;
      border:1px solid rgba(0,0,0,.10);
      box-shadow: 0 8px 16px rgba(0,0,0,.08);
    }

    /* Large text (senior mode) */
    .largeText .title{font-size:46px}
    .largeText .subtitle{font-size:15px}
    .largeText .rem-title{font-size:16px}
    .largeText .rem-meta{font-size:13px}

    /* ===== AI assistant: top-right button + in-phone chat overlay ===== */
    .aiTopBtn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      height:44px;
      padding:0 12px;
      border-radius: 14px;
      border:1px solid rgba(11,12,16,.08);
      background: rgba(255,255,255,.65);
      cursor:pointer;
      user-select:none;
      font-weight:850;
      color: rgba(11,12,16,.88);
      transition:.15s transform, .15s filter;
    }
    .aiTopBtn:active{transform:scale(.98); filter:brightness(.98)}
    .aiTopBtn svg{width:18px;height:18px; opacity:.9}

    .chatOverlay{
      position:absolute;
      inset:0;
      background: rgba(0,0,0,.45);
      display:none;
      align-items:flex-end;
      justify-content:center;
      padding:14px;
      z-index: 50;
    }
    .chatOverlay.show{display:flex}

    .chatSheet{
      width:100%;
      background: rgba(247,243,238,.98);
      border: 1px solid rgba(255,255,255,.35);
      border-radius: 26px;
      padding: 14px;
      box-shadow: 0 30px 70px rgba(0,0,0,.35);
      color: var(--ink);
      max-height: 85%;
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }

    .chatHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .chatTitle{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:900;
      letter-spacing:-.2px;
    }
    .chatMsgs{
      flex:1;
      overflow:auto;
      display:flex;
      flex-direction:column;
      gap:10px;
      padding: 6px 2px 12px;
      border-radius: 18px;
      border:1px solid rgba(11,12,16,.08);
      background: rgba(255,255,255,.7);
    }

    .chatBubble{
      max-width: 92%;
      border-radius: 18px;
      padding: 10px 12px;
      border:1px solid rgba(11,12,16,.10);
      background: rgba(255,255,255,.85);
      color: rgba(11,12,16,.86);
      line-height:1.35;
      font-size:13px;
    }
    .chatBubble.me{
      align-self:flex-end;
      background: linear-gradient(135deg, rgba(255,77,77,.18), rgba(255,122,61,.16));
      border-color: rgba(255,77,77,.22);
    }

    .chatInputRow{
      display:flex;
      gap:10px;
      margin-top:10px;
    }
    .chatInput{
      flex:1;
      border-radius: 18px;
      padding: 12px 12px;
      border:1px solid rgba(11,12,16,.12);
      background: rgba(255,255,255,.85);
      color: rgba(11,12,16,.9);
      outline:none;
      font-family: var(--font);
    }
    .chatSend{
      border:0;
      cursor:pointer;
      border-radius: 18px;
      padding: 12px 14px;
      font-weight:900;
      background: linear-gradient(135deg, var(--accent1), var(--accent2));
      color:#fff;
      box-shadow: 0 18px 40px rgba(255,77,77,.18);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div>
      <div class="phone">
        <div class="screen" id="app">
          <div class="topbar">
            <div class="brand">
              <div class="logo">C</div>
              <div>
                <div style="font-size:12px; opacity:.7; font-weight:800; letter-spacing:.2px;">Clear path</div>
                <div style="font-size:13px; font-weight:850; letter-spacing:-.2px;">Care & Payments</div>
              </div>
            </div>

            <div style="display:flex; gap:10px; align-items:center;">
              <button class="aiTopBtn" id="openChat" aria-label="Open AI assistant">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                  <path d="M21 15a4 4 0 0 1-4 4H8l-5 3 1.5-4.5A4 4 0 0 1 3 15V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"/>
                </svg>
                AI assistant
              </button>

              <button class="iconbtn" id="openAddTop" aria-label="Add reminder">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                  <path d="M12 5v14M5 12h14"/>
                </svg>
              </button>
            </div>
          </div>

          <div class="content">
            <!-- HOME -->
            <section class="view active" id="view-home">
              <div class="title">Reminders</div>
              <p class="subtitle" id="todayLine">Today overview‚Ä¶</p>

              <div class="seg" role="tablist" aria-label="Filter reminders">
                <button class="active" data-filter="upcoming">Upcoming</button>
                <button data-filter="today">Today</button>
                <button data-filter="overdue">Overdue</button>
              </div>

              <div class="statgrid">
                <div class="stat">
                  <div class="k">Due today</div>
                  <div class="v" id="statToday">0</div>
                  <div class="s">payments / meds / visits</div>
                </div>
                <div class="stat">
                  <div class="k">Overdue</div>
                  <div class="v" id="statOverdue">0</div>
                  <div class="s">needs attention</div>
                </div>
              </div>

              <div class="card">
                <div class="row">
                  <div class="badge">
                    <span>üîî</span>
                    <span>Tap a reminder for details</span>
                  </div>
                  <div class="pill" id="demoSeed">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                      <path d="M12 20h9"/><path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4Z"/>
                    </svg>
                    Load demo
                  </div>
                </div>

                <div style="margin-top:12px" id="reminderList"></div>
                <div class="empty" id="emptyState" style="display:none">
                  No reminders yet.<br/>
                  Tap <b>Ôºã</b> to add one.
                </div>
              </div>

              <div class="cta">
                <div>
                  <div style="font-size:12px; color:rgba(11,12,16,.62); font-weight:750;">Quick add</div>
                  <strong>Electricity bill</strong>
                </div>
                <button class="btn" id="quickElectricity">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                    <path d="M12 5v14M5 12h14"/>
                  </svg>
                  Add
                </button>
              </div>
            </section>

            <!-- CALENDAR -->
            <section class="view" id="view-calendar">
              <div class="title">Schedule</div>
              <p class="subtitle">Calendar markers are color-coded by type.</p>

              <div class="card">
                <div class="row">
                  <div class="badge">üìÖ <span id="calMonth">Month</span></div>
                  <div class="pill" id="jumpToday">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                      <path d="M8 7V3m8 4V3M4 11h16"/><path d="M5 21h14a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2Z"/>
                    </svg>
                    Today
                  </div>
                </div>

                <div class="calhead" id="calendarHead"></div>
                <div class="calgrid" id="calendarGrid"></div>

                <div style="margin-top:12px; display:flex; flex-wrap:wrap; gap:8px">
                  <div class="badge"><span style="width:10px;height:10px;border-radius:999px;background:var(--c-payment);display:inline-block"></span> Payment</div>
                  <div class="badge"><span style="width:10px;height:10px;border-radius:999px;background:var(--c-medicine);display:inline-block"></span> Medicine</div>
                  <div class="badge"><span style="width:10px;height:10px;border-radius:999px;background:var(--c-electric);display:inline-block"></span> Electricity</div>
                  <div class="badge"><span style="width:10px;height:10px;border-radius:999px;background:var(--c-appointment);display:inline-block"></span> Appointment</div>
                  <div class="badge"><span style="width:10px;height:10px;border-radius:999px;background:var(--c-other);display:inline-block"></span> Other</div>
                </div>
              </div>

              <div class="card" style="margin-top:12px">
                <div class="row">
                  <div class="badge">üßæ <span id="selectedDayLabel">Selected day</span></div>
                  <div class="pill" id="openAddFromCalendar">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                      <path d="M12 5v14M5 12h14"/>
                    </svg>
                    Add
                  </div>
                </div>

                <div style="margin-top:12px" id="dayList"></div>
                <div class="empty" id="dayEmpty" style="display:none">Nothing due on this day.</div>
              </div>
            </section>

            <!-- CONTACTS -->
            <section class="view" id="view-contacts">
              <div class="title">Contacts</div>
              <p class="subtitle">Add a caregiver contact (for calling/texting outside this app).</p>

              <div class="card">
                <div class="row">
                  <div class="badge">üë§ <span>Caregiver</span></div>
                  <div class="pill" id="addContactBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                      <path d="M12 5v14M5 12h14"/>
                    </svg>
                    Add
                  </div>
                </div>

                <div style="margin-top:12px" id="contactList"></div>
                <div class="empty" id="contactEmpty" style="display:none">No contacts yet.</div>
              </div>

              <div class="card" style="margin-top:12px">
                <div class="badge">‚òéÔ∏è Quick actions</div>
                <div style="margin-top:10px; display:grid; gap:10px">
                  <button class="pill" id="exportBtn" style="justify-content:center">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                      <path d="M12 3v12"/><path d="m7 10 5 5 5-5"/><path d="M5 21h14"/>
                    </svg>
                    Export data (JSON)
                  </button>
                  <button class="pill" id="clearBtn" style="justify-content:center">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                      <path d="M3 6h18"/><path d="M8 6V4h8v2"/><path d="M19 6l-1 14H6L5 6"/>
                    </svg>
                    Clear all (local)
                  </button>
                </div>
              </div>
            </section>

            <!-- SETTINGS -->
            <section class="view" id="view-settings">
              <div class="title">Settings</div>
              <p class="subtitle">Make it senior-friendly: bigger text, simple notifications.</p>

              <div class="card">
                <div class="row">
                  <div class="badge">üÖ∞Ô∏è <span>Large text</span></div>
                  <label class="pill" style="cursor:pointer">
                    <input type="checkbox" id="largeText" style="width:16px;height:16px; accent-color: var(--accent2);" />
                    Toggle
                  </label>
                </div>

                <div style="margin-top:12px" class="row">
                  <div class="badge">üîî <span>Browser alerts</span></div>
                  <button class="pill" id="notifBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                      <path d="M18 8a6 6 0 1 0-12 0c0 7-3 7-3 7h18s-3 0-3-7"/>
                      <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
                    </svg>
                    Enable
                  </button>
                </div>

                <div style="margin-top:12px; color:rgba(11,12,16,.62); font-size:13px; line-height:1.45">
                  Notes:
                  <ul style="margin:8px 0 0 18px; padding:0">
                    <li>This demo uses <b>localStorage</b> only.</li>
                    <li>Click a reminder to open full details (amount/place/etc.).</li>
                  </ul>
                </div>
              </div>
            </section>
          </div>

          <!-- Bottom nav -->
          <nav class="nav" aria-label="Bottom navigation">
            <button class="active" data-go="home" aria-label="Home">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                <path d="M3 10.5 12 3l9 7.5V21a1.5 1.5 0 0 1-1.5 1.5H4.5A1.5 1.5 0 0 1 3 21z"/>
                <path d="M9 22V14h6v8"/>
              </svg>
              Home
              <div class="navdot"></div>
            </button>
            <button data-go="calendar" aria-label="Calendar">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                <path d="M8 3v4M16 3v4M4 11h16"/>
                <path d="M5 21h14a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2Z"/>
              </svg>
              Calendar
            </button>
            <button data-go="contacts" aria-label="Contacts">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <path d="M12 11a4 4 0 1 0-4-4 4 4 0 0 0 4 4Z"/>
              </svg>
              Contacts
            </button>
            <button data-go="settings" aria-label="Settings">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                <path d="M12 15.5a3.5 3.5 0 1 0-3.5-3.5 3.5 3.5 0 0 0 3.5 3.5Z"/>
                <path d="M19.4 15a7.9 7.9 0 0 0 .1-2l2-1.2-2-3.4-2.3.6a8 8 0 0 0-1.7-1l-.3-2.4H11l-.3 2.4a8 8 0 0 0-1.7 1l-2.3-.6-2 3.4 2 1.2a7.9 7.9 0 0 0 .1 2l-2 1.2 2 3.4 2.3-.6a8 8 0 0 0 1.7 1l.3 2.4h4l.3-2.4a8 8 0 0 0 1.7-1l2.3.6 2-3.4Z"/>
              </svg>
              Settings
            </button>
          </nav>

          <!-- AI Chat Overlay -->
          <div class="chatOverlay" id="chatOverlay" aria-hidden="true">
            <div class="chatSheet" role="dialog" aria-modal="true" aria-label="AI assistant chat">
              <div class="chatHead">
                <div class="chatTitle">
                  <span style="width:10px;height:10px;border-radius:999px;background:linear-gradient(135deg,var(--accent1),var(--accent2));display:inline-block"></span>
                  AI assistant
                </div>
                <button class="iconbtn" id="closeChat" aria-label="Close chat">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                    <path d="M6 6l12 12M18 6L6 18"/>
                  </svg>
                </button>
              </div>

              <div class="chatMsgs" id="aiMsgs"></div>

              <div class="chatInputRow">
                <input class="chatInput" id="aiInput" placeholder="Ask: ‚ÄúWhat‚Äôs due today?‚Äù" />
                <button class="chatSend" id="aiSend">Send</button>
              </div>

              <div style="margin-top:10px; color:rgba(11,12,16,.62); font-size:12px; line-height:1.35">
                Local demo (no internet). Try: ‚Äútoday‚Äù, ‚Äúoverdue‚Äù, ‚Äúnext payment‚Äù.
              </div>
            </div>
          </div>

          <!-- Modal / Sheet (Add + Details + Contacts) -->
          <div class="modal" id="modal">
            <div class="sheet" role="dialog" aria-modal="true" aria-label="Sheet">
              <div class="head">
                <h3 id="sheetTitle">Add reminder</h3>
                <button class="iconbtn" id="closeModal" aria-label="Close">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                    <path d="M6 6l12 12M18 6L6 18"/>
                  </svg>
                </button>
              </div>

              <!-- Reminder form -->
              <form id="remForm">
                <div class="field">
                  <label>Type</label>
                  <select id="type">
                    <option value="payment">Payment</option>
                    <option value="medicine">Medicine</option>
                    <option value="electricity">Electricity</option>
                    <option value="appointment">Appointment</option>
                    <option value="other">Other</option>
                  </select>
                </div>

                <div class="field">
                  <label>Title</label>
                  <input class="input" id="title" placeholder="e.g., Electricity bill" required />
                </div>

                <div class="grid2">
                  <div class="field">
                    <label>Due date</label>
                    <input class="input" id="date" type="date" required />
                  </div>
                  <div class="field">
                    <label>Time (optional)</label>
                    <input class="input" id="time" type="time" />
                  </div>
                </div>

                <div class="grid2">
                  <div class="field">
                    <label>Amount (optional)</label>
                    <input class="input" id="amount" type="number" step="0.01" placeholder="e.g., 68.90" />
                  </div>
                  <div class="field">
                    <label>Currency</label>
                    <select id="currency">
                      <option value="USD">USD</option>
                      <option value="THB">THB</option>
                      <option value="SGD">SGD</option>
                      <option value="EUR">EUR</option>
                    </select>
                  </div>
                </div>

                <div class="field">
                  <label>Place / Provider (optional)</label>
                  <input class="input" id="place" placeholder="e.g., National Grid / PEA / Hospital name" />
                </div>

                <div class="grid2">
                  <div class="field">
                    <label>Repeat</label>
                    <select id="repeat">
                      <option value="none">None</option>
                      <option value="daily">Daily</option>
                      <option value="weekly">Weekly</option>
                      <option value="monthly">Monthly</option>
                    </select>
                  </div>
                  <div class="field">
                    <label>Priority</label>
                    <select id="priority">
                      <option value="normal">Normal</option>
                      <option value="high">High</option>
                      <option value="urgent">Urgent</option>
                    </select>
                  </div>
                </div>

                <div class="field">
                  <label>Details / Notes</label>
                  <textarea id="note" placeholder="e.g., Pay via bank app. Account: **** 1234."></textarea>
                </div>

                <div class="actions">
                  <button type="button" class="btn ghost" id="cancelBtn">Cancel</button>
                  <button type="submit" class="btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                      <path d="M20 6 9 17l-5-5"/>
                    </svg>
                    Save
                  </button>
                </div>
              </form>

              <!-- Details view -->
              <div id="detailView" style="display:none">
                <div class="card" style="margin-top:8px">
                  <div class="row">
                    <div class="badge" id="detailBadge">üìå Details</div>
                    <div class="pill" id="editBtn">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                        <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4Z"/>
                      </svg>
                      Edit
                    </div>
                  </div>

                  <div style="margin-top:12px; display:grid; gap:10px; color:rgba(11,12,16,.8)">
                    <div><b id="dTitle">‚Äî</b></div>
                    <div style="color:rgba(11,12,16,.65); font-size:13px" id="dWhen">‚Äî</div>
                    <div id="dAmountRow" style="display:none">
                      <span class="badge">üíµ <span id="dAmount">‚Äî</span></span>
                    </div>
                    <div id="dPlaceRow" style="display:none">
                      <span class="badge">üìç <span id="dPlace">‚Äî</span></span>
                    </div>
                    <div id="dRepeatRow" style="display:none">
                      <span class="badge">üîÅ <span id="dRepeat">‚Äî</span></span>
                    </div>
                    <div id="dPriorityRow" style="display:none">
                      <span class="badge">‚ö° <span id="dPriority">‚Äî</span></span>
                    </div>
                    <div id="dNoteRow" style="display:none">
                      <div class="badge">üìù Notes</div>
                      <div style="margin-top:6px; color:rgba(11,12,16,.68); line-height:1.45" id="dNote">‚Äî</div>
                    </div>
                  </div>

                  <div class="actions" style="margin-top:14px">
                    <button class="btn ghost" id="markDoneBtn">Mark done</button>
                    <button class="btn" id="deleteBtn" style="background:linear-gradient(135deg, #ff4d4d, #ff4d4d)">Delete</button>
                  </div>
                </div>
              </div>

              <!-- Contact form -->
              <form id="contactForm" style="display:none">
                <div class="field">
                  <label>Name</label>
                  <input class="input" id="cName" placeholder="e.g., Aunt Som" required />
                </div>
                <div class="grid2">
                  <div class="field">
                    <label>Phone (optional)</label>
                    <input class="input" id="cPhone" placeholder="+1 555 123 4567" />
                  </div>
                  <div class="field">
                    <label>Relationship</label>
                    <input class="input" id="cRel" placeholder="Daughter / Caregiver" />
                  </div>
                </div>

                <div class="actions">
                  <button type="button" class="btn ghost" id="cancelContact">Cancel</button>
                  <button type="submit" class="btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                      <path d="M20 6 9 17l-5-5"/>
                    </svg>
                    Save
                  </button>
                </div>
              </form>

            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <script>
    // ---------- Helpers ----------
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
    const fmtDate = (d) => new Intl.DateTimeFormat(undefined, {weekday:"short", month:"short", day:"numeric"}).format(d);
    const fmtDay = (d) => new Intl.DateTimeFormat(undefined, {year:"numeric", month:"long", day:"numeric"}).format(d);
    const uid = () => Math.random().toString(16).slice(2) + Date.now().toString(16);

    // ---------- Storage ----------
    const KEY = "senior_reminders_v3_clearpath";
    const CKEY = "senior_contacts_v3_clearpath";
    const SKEY = "senior_settings_v3_clearpath";

    const load = (k, fallback) => {
      try { return JSON.parse(localStorage.getItem(k)) ?? fallback; }
      catch { return fallback; }
    };
    const save = (k, v) => localStorage.setItem(k, JSON.stringify(v));

    let reminders = load(KEY, []);
    let contacts  = load(CKEY, []);
    let settings  = load(SKEY, { largeText:false });

    // ---------- Type -> color ----------
    const typeColor = (type) => {
      if(type === "payment") return getCSS("--c-payment");
      if(type === "medicine") return getCSS("--c-medicine");
      if(type === "electricity") return getCSS("--c-electric");
      if(type === "appointment") return getCSS("--c-appointment");
      return getCSS("--c-other");
    };
    function getCSS(varName){
      return getComputedStyle(document.documentElement).getPropertyValue(varName).trim();
    }

    // ---------- UI ----------
    const modal = $("#modal");
    const remForm = $("#remForm");
    const contactForm = $("#contactForm");
    const detailView = $("#detailView");

    const viewMap = {
      home: $("#view-home"),
      calendar: $("#view-calendar"),
      contacts: $("#view-contacts"),
      settings: $("#view-settings"),
    };

    // ---------- Navigation ----------
    function go(view){
      $$(".view").forEach(v => v.classList.remove("active"));
      viewMap[view].classList.add("active");

      $$(".nav button").forEach(b => b.classList.toggle("active", b.dataset.go === view));
      $$(".navdot").forEach(d => d.remove());
      const activeBtn = $(`.nav button[data-go="${view}"]`);
      const dot = document.createElement("div");
      dot.className = "navdot";
      activeBtn.appendChild(dot);

      if(view === "calendar") renderCalendar(selectedDate);
      if(view === "contacts") renderContacts();
      if(view === "settings") renderSettings();
      if(view === "home") renderHome();
    }
    $$(".nav button").forEach(btn => btn.addEventListener("click", () => go(btn.dataset.go)));

    // ---------- Modal controls ----------
    function showSheet(mode){
      // mode: "add" | "detail" | "contact"
      remForm.style.display = (mode === "add") ? "" : "none";
      detailView.style.display = (mode === "detail") ? "" : "none";
      contactForm.style.display = (mode === "contact") ? "" : "none";
    }

    function openReminderSheet(prefill = {}, editingId = null){
      $("#sheetTitle").textContent = editingId ? "Edit reminder" : "Add reminder";
      showSheet("add");
      remForm.dataset.editingId = editingId || "";

      const d = new Date();
      const plus7 = new Date(d); plus7.setDate(d.getDate()+7);

      $("#type").value = prefill.type ?? "payment";
      $("#title").value = prefill.title ?? "";
      $("#date").value = prefill.date ?? plus7.toISOString().slice(0,10);
      $("#time").value = prefill.time ?? "";
      $("#amount").value = (prefill.amount ?? "") === null ? "" : (prefill.amount ?? "");
      $("#currency").value = prefill.currency ?? "USD";
      $("#place").value = prefill.place ?? "";
      $("#repeat").value = prefill.repeat ?? "none";
      $("#priority").value = prefill.priority ?? "normal";
      $("#note").value = prefill.note ?? "";

      modal.classList.add("show");
    }

    function openDetailsSheet(id){
      const r = reminders.find(x => x.id === id);
      if(!r) return;

      $("#sheetTitle").textContent = "Reminder details";
      showSheet("detail");

      $("#detailBadge").textContent = `${iconForType(r.type)} ${cap(r.type)}`;
      $("#dTitle").textContent = r.title;

      const due = new Date(r.date + "T00:00:00");
      $("#dWhen").textContent = `${fmtDay(due)}${r.time ? " ‚Ä¢ " + r.time : ""}`;

      const hasAmount = r.amount !== undefined && r.amount !== null && String(r.amount).trim() !== "";
      $("#dAmountRow").style.display = hasAmount ? "" : "none";
      if(hasAmount) $("#dAmount").textContent = `${r.currency || "USD"} ${Number(r.amount).toFixed(2)}`;

      const hasPlace = !!(r.place && r.place.trim());
      $("#dPlaceRow").style.display = hasPlace ? "" : "none";
      if(hasPlace) $("#dPlace").textContent = r.place;

      $("#dRepeatRow").style.display = (r.repeat && r.repeat !== "none") ? "" : "none";
      if(r.repeat && r.repeat !== "none") $("#dRepeat").textContent = r.repeat;

      $("#dPriorityRow").style.display = (r.priority && r.priority !== "normal") ? "" : "none";
      if(r.priority && r.priority !== "normal") $("#dPriority").textContent = r.priority;

      $("#dNoteRow").style.display = (r.note && r.note.trim()) ? "" : "none";
      if(r.note && r.note.trim()) $("#dNote").textContent = r.note;

      $("#markDoneBtn").onclick = () => { toggleDone(id); closeSheet(); };
      $("#deleteBtn").onclick = () => { removeReminder(id); closeSheet(); };
      $("#editBtn").onclick = () => openReminderSheet({ ...r }, r.id);

      modal.classList.add("show");
    }

    function openContactSheet(){
      $("#sheetTitle").textContent = "Add contact";
      showSheet("contact");
      $("#cName").value = "";
      $("#cPhone").value = "";
      $("#cRel").value = "";
      modal.classList.add("show");
    }

    function closeSheet(){
      modal.classList.remove("show");
    }

    $("#openAddTop").addEventListener("click", () => openReminderSheet());
    $("#quickElectricity").addEventListener("click", () => openReminderSheet({
      type:"electricity",
      title:"Electricity bill",
      currency:"USD",
      amount:""
    }));
    $("#openAddFromCalendar").addEventListener("click", () => openReminderSheet({ date: selectedDate.toISOString().slice(0,10) }));

    $("#closeModal").addEventListener("click", closeSheet);
    $("#cancelBtn").addEventListener("click", closeSheet);
    $("#cancelContact").addEventListener("click", closeSheet);
    modal.addEventListener("click", (e) => { if(e.target === modal) closeSheet(); });

    // ---------- Reminder CRUD ----------
    remForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const editingId = remForm.dataset.editingId || "";

      const payload = {
        type: $("#type").value,
        title: $("#title").value.trim(),
        date: $("#date").value,
        time: $("#time").value,
        amount: $("#amount").value === "" ? "" : $("#amount").value,
        currency: $("#currency").value,
        place: $("#place").value.trim(),
        repeat: $("#repeat").value,
        priority: $("#priority").value,
        note: $("#note").value.trim(),
      };

      if(editingId){
        const r = reminders.find(x => x.id === editingId);
        if(r){
          Object.assign(r, payload);
          save(KEY, reminders);
          closeSheet();
          renderAll();
          maybeNotify("Updated", r.title);
          return;
        }
      }

      const item = {
        id: uid(),
        ...payload,
        done: false,
        createdAt: Date.now()
      };
      reminders.unshift(item);
      save(KEY, reminders);
      closeSheet();
      renderAll();
      maybeNotify("Saved", item.title);
    });

    function toggleDone(id){
      const r = reminders.find(x => x.id === id);
      if(!r) return;
      r.done = !r.done;

      if(r.done && r.repeat && r.repeat !== "none"){
        const next = nextOccurrence(r);
        reminders.unshift(next);
      }
      save(KEY, reminders);
      renderAll();
    }

    function removeReminder(id){
      reminders = reminders.filter(x => x.id !== id);
      save(KEY, reminders);
      renderAll();
    }

    function nextOccurrence(r){
      const base = new Date(r.date + "T00:00:00");
      const n = new Date(base);
      if(r.repeat === "daily") n.setDate(base.getDate() + 1);
      if(r.repeat === "weekly") n.setDate(base.getDate() + 7);
      if(r.repeat === "monthly") n.setMonth(base.getMonth() + 1);

      return {
        ...r,
        id: uid(),
        date: n.toISOString().slice(0,10),
        done: false,
        createdAt: Date.now(),
      };
    }

    // ---------- Filters ----------
    let activeFilter = "upcoming";
    $$(".seg button").forEach(b => {
      b.addEventListener("click", () => {
        $$(".seg button").forEach(x => x.classList.remove("active"));
        b.classList.add("active");
        activeFilter = b.dataset.filter;
        renderHome();
      });
    });

    function classify(r){
      const today = new Date(); today.setHours(0,0,0,0);
      const due = new Date(r.date + "T00:00:00");
      if(r.done) return "done";
      if(due < today) return "overdue";
      if(due.getTime() === today.getTime()) return "today";
      return "upcoming";
    }

    function filteredReminders(){
      const list = reminders.filter(r => !r.done);
      if(activeFilter === "upcoming") return list.filter(r => ["today","upcoming"].includes(classify(r)));
      if(activeFilter === "today") return list.filter(r => classify(r) === "today");
      if(activeFilter === "overdue") return list.filter(r => classify(r) === "overdue");
      return list;
    }

    // ---------- Render: Home ----------
    function renderHome(){
      const now = new Date();
      $("#todayLine").textContent = `${fmtDate(now)} ‚Ä¢ Tap a reminder to view amount, place, and notes.`;

      const todayCount = reminders.filter(r => !r.done && classify(r) === "today").length;
      const overdueCount = reminders.filter(r => !r.done && classify(r) === "overdue").length;
      $("#statToday").textContent = todayCount;
      $("#statOverdue").textContent = overdueCount;

      const list = filteredReminders()
        .sort((a,b)=> (a.date+(a.time||"")).localeCompare(b.date+(b.time||"")));

      const root = $("#reminderList");
      root.innerHTML = "";

      $("#emptyState").style.display = (reminders.filter(r=>!r.done).length === 0) ? "" : "none";

      list.forEach(r => root.appendChild(reminderRow(r, true)));
    }

    function iconForType(type){
      if(type==="payment") return "üí≥";
      if(type==="medicine") return "üíä";
      if(type==="electricity") return "‚ö°";
      if(type==="appointment") return "üè•";
      return "üìå";
    }

    function reminderRow(r, clickable){
      const due = new Date(r.date + "T00:00:00");
      const tag = classify(r);
      const tagLabel = tag === "overdue" ? "Overdue" : tag === "today" ? "Today" : "Upcoming";

      const el = document.createElement("div");
      el.className = "reminder";
      if(!clickable) el.style.cursor = "default";

      const left = document.createElement("div");
      left.className = "rem-left";

      const dot = document.createElement("div");
      dot.className = "dot";
      dot.style.background = typeColor(r.type);

      const text = document.createElement("div");
      const amountMini = (r.amount !== undefined && r.amount !== null && String(r.amount).trim() !== "")
        ? ` ‚Ä¢ ${escapeHtml(r.currency || "USD")} ${Number(r.amount).toFixed(2)}`
        : "";
      const placeMini = (r.place && r.place.trim()) ? ` ‚Ä¢ ${escapeHtml(r.place)}` : "";

      text.innerHTML = `
        <div class="rem-title">${iconForType(r.type)} ${escapeHtml(r.title)}</div>
        <div class="rem-meta">${fmtDay(due)}${r.time ? " ‚Ä¢ " + r.time : ""}${amountMini}${placeMini} ‚Ä¢ ${tagLabel}${r.repeat !== "none" ? " ‚Ä¢ repeats " + r.repeat : ""}</div>
      `;

      left.appendChild(dot);
      left.appendChild(text);

      const right = document.createElement("div");
      right.style.display = "flex";
      right.style.flexDirection = "column";
      right.style.gap = "8px";
      right.style.alignItems = "flex-end";

      const doneBtn = document.createElement("div");
      doneBtn.className = "pill";
      doneBtn.innerHTML = `
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
          <path d="M20 6 9 17l-5-5"/>
        </svg>
        Done
      `;
      doneBtn.addEventListener("click", (e) => { e.stopPropagation(); toggleDone(r.id); });

      right.appendChild(doneBtn);

      el.appendChild(left);
      el.appendChild(right);

      if(clickable){
        el.addEventListener("click", () => openDetailsSheet(r.id));
      }

      return el;
    }

    // ---------- Render: Calendar ----------
    let selectedDate = new Date(); selectedDate.setHours(0,0,0,0);

    $("#jumpToday").addEventListener("click", () => {
      selectedDate = new Date(); selectedDate.setHours(0,0,0,0);
      renderCalendar(selectedDate);
    });

    function renderCalendar(focusDate){
      const y = focusDate.getFullYear();
      const m = focusDate.getMonth();
      const first = new Date(y, m, 1);
      const startDay = (first.getDay()+6)%7; // Monday=0
      const daysInMonth = new Date(y, m+1, 0).getDate();

      $("#calMonth").textContent = new Intl.DateTimeFormat(undefined, {month:"long", year:"numeric"}).format(focusDate);

      const head = $("#calendarHead");
      head.innerHTML = "";
      ["M","T","W","T","F","S","S"].forEach(w=>{
        const d = document.createElement("div");
        d.textContent = w;
        head.appendChild(d);
      });

      const grid = $("#calendarGrid");
      grid.innerHTML = "";

      for(let i=0;i<startDay;i++){
        const pad = document.createElement("div");
        pad.style.height="42px";
        grid.appendChild(pad);
      }

      const today = new Date(); today.setHours(0,0,0,0);

      for(let day=1; day<=daysInMonth; day++){
        const cellDate = new Date(y, m, day);
        cellDate.setHours(0,0,0,0);
        const iso = cellDate.toISOString().slice(0,10);

        const items = reminders.filter(r => !r.done && r.date === iso);

        const btn = document.createElement("button");
        btn.className = "calbtn";
        btn.type = "button";
        btn.textContent = day;

        if(cellDate.getTime() === today.getTime()) btn.classList.add("is-today");
        if(cellDate.getTime() === selectedDate.getTime()) btn.classList.add("is-selected");

        const types = [...new Set(items.map(x => x.type))].slice(0,4);
        if(types.length){
          const marks = document.createElement("div");
          marks.className = "calmarks";
          types.forEach(t=>{
            const mk = document.createElement("div");
            mk.className = "mark";
            mk.style.background = typeColor(t);
            marks.appendChild(mk);
          });
          btn.appendChild(marks);
        }

        btn.addEventListener("click", ()=>{
          selectedDate = cellDate;
          renderCalendar(selectedDate);
        });

        grid.appendChild(btn);
      }

      $("#selectedDayLabel").textContent = fmtDay(selectedDate);
      renderDayList(selectedDate);
    }

    function renderDayList(dateObj){
      const iso = dateObj.toISOString().slice(0,10);
      const list = reminders
        .filter(r => !r.done && r.date === iso)
        .sort((a,b)=>(a.time||"").localeCompare(b.time||""));

      const root = $("#dayList");
      root.innerHTML = "";
      $("#dayEmpty").style.display = list.length ? "none" : "";

      list.forEach(r => root.appendChild(reminderRow(r, true)));
    }

    // ---------- Contacts ----------
    $("#addContactBtn").addEventListener("click", openContactSheet);

    contactForm.addEventListener("submit", (e)=>{
      e.preventDefault();
      const c = {
        id: uid(),
        name: $("#cName").value.trim(),
        phone: $("#cPhone").value.trim(),
        rel: $("#cRel").value.trim()
      };
      contacts.unshift(c);
      save(CKEY, contacts);
      closeSheet();
      renderContacts();
      maybeNotify("Saved", c.name);
    });

    function renderContacts(){
      const root = $("#contactList");
      root.innerHTML = "";
      $("#contactEmpty").style.display = contacts.length ? "none" : "";

      contacts.forEach(c=>{
        const el = document.createElement("div");
        el.className = "reminder";
        el.style.cursor = "default";
        el.innerHTML = `
          <div class="rem-left">
            <div class="dot" style="background:linear-gradient(135deg,var(--accent1),var(--accent2))"></div>
            <div>
              <div class="rem-title">üë§ ${escapeHtml(c.name)}</div>
              <div class="rem-meta">${escapeHtml(c.rel || "Caregiver")}${c.phone ? " ‚Ä¢ " + escapeHtml(c.phone) : ""}</div>
            </div>
          </div>
          <div style="display:flex; flex-direction:column; gap:8px; align-items:flex-end">
            ${c.phone ? `
              <a class="pill" href="tel:${encodeURIComponent(c.phone)}" style="text-decoration:none">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                  <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.8 19.8 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6A19.8 19.8 0 0 1 2.08 4.18 2 2 0 0 1 4.06 2h3a2 2 0 0 1 2 1.72c.12.86.3 1.7.54 2.5a2 2 0 0 1-.45 2.11L8.1 9.9a16 16 0 0 0 6 6l1.57-1.05a2 2 0 0 1 2.11-.45c.8.24 1.64.42 2.5.54A2 2 0 0 1 22 16.92Z"/>
                </svg>
                Call
              </a>
            ` : ""}
            <div class="pill" style="background:rgba(11,12,16,.04)" data-del="${c.id}">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                <path d="M3 6h18"/><path d="M8 6V4h8v2"/><path d="M19 6l-1 14H6L5 6"/>
              </svg>
              Remove
            </div>
          </div>
        `;
        root.appendChild(el);
      });

      $$("[data-del]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-del");
          contacts = contacts.filter(x=>x.id!==id);
          save(CKEY, contacts);
          renderContacts();
        });
      });
    }

    // ---------- Settings ----------
    function renderSettings(){
      $("#largeText").checked = !!settings.largeText;
      applyLargeText();
      updateNotifButton();
    }

    $("#largeText").addEventListener("change", (e)=>{
      settings.largeText = e.target.checked;
      save(SKEY, settings);
      applyLargeText();
    });

    function applyLargeText(){
      const app = $("#app");
      if(settings.largeText) app.classList.add("largeText");
      else app.classList.remove("largeText");
    }

    // ---------- Notifications ----------
    function updateNotifButton(){
      const btn = $("#notifBtn");
      const supported = "Notification" in window;
      if(!supported){
        btn.textContent = "Not supported";
        btn.disabled = true;
        btn.style.opacity = ".6";
        return;
      }
      btn.disabled = false;
      btn.style.opacity = "1";
      btn.innerHTML = `
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
          <path d="M18 8a6 6 0 1 0-12 0c0 7-3 7-3 7h18s-3 0-3-7"/>
          <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
        </svg>
        ${("Notification" in window && Notification.permission === "granted") ? "Enabled" : "Enable"}
      `;
    }

    $("#notifBtn").addEventListener("click", async ()=>{
      if(!("Notification" in window)) return;
      const perm = await Notification.requestPermission();
      updateNotifButton();
      if(perm === "granted") maybeNotify("Notifications", "Enabled");
    });

    function maybeNotify(title, body){
      if(!("Notification" in window)) return;
      if(Notification.permission !== "granted") return;
      try{ new Notification(title, { body }); }catch(e){}
    }

    // ---------- Export / Clear ----------
    $("#exportBtn").addEventListener("click", ()=>{
      const data = { reminders, contacts, settings, exportedAt: new Date().toISOString() };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type:"application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "clear-path-export.json";
      a.click();
      URL.revokeObjectURL(url);
    });

    $("#clearBtn").addEventListener("click", ()=>{
      const ok = confirm("Clear all local reminders and contacts?");
      if(!ok) return;
      reminders = [];
      contacts = [];
      save(KEY, reminders);
      save(CKEY, contacts);
      renderAll();
      renderContacts();
    });

    // ---------- Demo seed ----------
    $("#demoSeed").addEventListener("click", ()=>{
      if(reminders.length) {
        const ok = confirm("Replace current reminders with demo data?");
        if(!ok) return;
      }
      const today = new Date(); today.setHours(0,0,0,0);
      const iso = (d)=> d.toISOString().slice(0,10);

      const d1 = new Date(today); d1.setDate(today.getDate()+0);
      const d2 = new Date(today); d2.setDate(today.getDate()+2);
      const d3 = new Date(today); d3.setDate(today.getDate()-1);
      const d4 = new Date(today); d4.setDate(today.getDate()+7);

      reminders = [
        {id:uid(), type:"medicine", title:"Blood pressure medicine", date:iso(d1), time:"08:00", repeat:"daily", priority:"high", note:"After breakfast", amount:"", currency:"USD", place:"", done:false, createdAt:Date.now()},
        {id:uid(), type:"payment", title:"Rent payment", date:iso(d2), time:"", repeat:"monthly", priority:"normal", note:"Pay via bank app", amount:"1250", currency:"USD", place:"Landlord", done:false, createdAt:Date.now()},
        {id:uid(), type:"electricity", title:"Electricity bill", date:iso(d2), time:"", repeat:"monthly", priority:"high", note:"Account: **** 4040", amount:"68.90", currency:"USD", place:"National Grid", done:false, createdAt:Date.now()},
        {id:uid(), type:"appointment", title:"Clinic visit", date:iso(d4), time:"10:30", repeat:"none", priority:"urgent", note:"Bring ID & insurance", amount:"20", currency:"USD", place:"Community Clinic", done:false, createdAt:Date.now()},
        {id:uid(), type:"other", title:"Call insurance", date:iso(d3), time:"", repeat:"none", priority:"high", note:"Ask about coverage details", amount:"", currency:"USD", place:"", done:false, createdAt:Date.now()},
      ];
      save(KEY, reminders);

      contacts = [{id:uid(), name:"May (Caregiver)", phone:"+15551234567", rel:"Daughter"}];
      save(CKEY, contacts);

      renderAll();
      aiSay("Demo loaded. Ask me: ‚ÄúWhat‚Äôs due today?‚Äù");
      maybeNotify("Demo loaded", "Tap a reminder to see details.");
    });

    // ---------- AI assistant (local demo bot) ----------
    const chatOverlay = $("#chatOverlay");
    const openChat = $("#openChat");
    const closeChat = $("#closeChat");

    const aiMsgs = $("#aiMsgs");
    const aiInput = $("#aiInput");
    const aiSend = $("#aiSend");

    function openChatOverlay(){
      chatOverlay.classList.add("show");
      chatOverlay.setAttribute("aria-hidden","false");
      if(aiMsgs && !aiMsgs.childElementCount){
        aiSay("Hi ‚Äî Ask me: ‚ÄúWhat‚Äôs due today?‚Äù");
      }
      setTimeout(()=> aiInput?.focus(), 0);
    }

    function closeChatOverlay(){
      chatOverlay.classList.remove("show");
      chatOverlay.setAttribute("aria-hidden","true");
    }

    openChat?.addEventListener("click", openChatOverlay);
    closeChat?.addEventListener("click", closeChatOverlay);
    chatOverlay?.addEventListener("click", (e)=>{
      if(e.target === chatOverlay) closeChatOverlay();
    });

    function aiSay(text){
      if(!aiMsgs) return;
      const b = document.createElement("div");
      b.className = "chatBubble";
      b.textContent = text;
      aiMsgs.appendChild(b);
      aiMsgs.scrollTop = aiMsgs.scrollHeight;
    }
    function aiMe(text){
      if(!aiMsgs) return;
      const b = document.createElement("div");
      b.className = "chatBubble me";
      b.textContent = text;
      aiMsgs.appendChild(b);
      aiMsgs.scrollTop = aiMsgs.scrollHeight;
    }

    function dueSummary(mode){
      const today = new Date(); today.setHours(0,0,0,0);
      const isoToday = today.toISOString().slice(0,10);

      let list = reminders.filter(r => !r.done);
      if(mode === "today") list = list.filter(r => r.date === isoToday);
      if(mode === "overdue") list = list.filter(r => classify(r) === "overdue");
      if(mode === "upcoming") list = list.filter(r => ["today","upcoming"].includes(classify(r)));

      list.sort((a,b)=> (a.date+(a.time||"")).localeCompare(b.date+(b.time||"")));

      if(!list.length) return "Nothing due right now. ‚úÖ";

      const top = list.slice(0,6).map(r=>{
        const icon = iconForType(r.type);
        const when = r.date + (r.time ? " " + r.time : "");
        const amt = (r.amount && String(r.amount).trim()) ? ` ‚Ä¢ ${r.currency||"USD"} ${Number(r.amount).toFixed(2)}` : "";
        return `${icon} ${r.title} ‚Äî ${when}${amt}`;
      });

      return `Here‚Äôs what you have (${mode}):\n` + top.join("\n");
    }

    function aiRespond(text){
      const t = text.toLowerCase();

      if(t.includes("today")) return dueSummary("today");
      if(t.includes("overdue") || t.includes("late")) return dueSummary("overdue");
      if(t.includes("upcoming") || t.includes("next")) return dueSummary("upcoming");

      if(t.includes("pay") || t.includes("payment") || t.includes("bill")){
        const pays = reminders.filter(r => !r.done && ["payment","electricity"].includes(r.type))
                              .sort((a,b)=> (a.date+(a.time||"")).localeCompare(b.date+(b.time||"")));
        if(!pays.length) return "No payments found. ‚úÖ";
        const p = pays[0];
        const amt = (p.amount && String(p.amount).trim()) ? `${p.currency||"USD"} ${Number(p.amount).toFixed(2)}` : "No amount saved";
        return `Next payment: ${p.title} on ${p.date}${p.time ? " " + p.time : ""} ‚Ä¢ ${amt}${p.place ? " ‚Ä¢ " + p.place : ""}.`;
      }

      return "Try: ‚ÄúWhat‚Äôs due today?‚Äù, ‚ÄúShow overdue‚Äù, or ‚ÄúNext payment‚Äù.";
    }

    function sendAI(){
      const text = (aiInput.value || "").trim();
      if(!text) return;
      aiMe(text);
      aiInput.value = "";
      setTimeout(()=> aiSay(aiRespond(text)), 160);
    }

    aiSend?.addEventListener("click", sendAI);
    aiInput?.addEventListener("keydown", (e)=>{ if(e.key==="Enter") sendAI(); });

    // ---------- Safety: escape HTML ----------
    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, (m)=>({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[m]));
    }
    function cap(s){ return s ? (s[0].toUpperCase()+s.slice(1)) : s; }

    // ---------- Render all ----------
    function renderAll(){
      renderHome();
      renderCalendar(selectedDate);
      renderContacts();
      renderSettings();
    }

    // Initial render
    renderAll();

    // Optional: ‚Äúdue today‚Äù notification when app opens
    (function notifyDueToday(){
      const todayIso = new Date().toISOString().slice(0,10);
      const due = reminders.filter(r => !r.done && r.date === todayIso);
      if(due.length && "Notification" in window && Notification.permission === "granted"){
        maybeNotify("Due today", `${due.length} reminder(s)`);
      }
    })();
  </script>
</body>
</html>
